!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";function d(){this.settingsPrefix="",this.REST_PATH=null,this.SITE_ROOT=null,this.SERVICES_ENDPOINT=null}var e=1,f=3,g=null,h=null,i=null;g=f,h={setString:function(a,b){localStorage.setItem(a,b)},getString:function(a,b){var c=localStorage.getItem(a);return void 0===c?b:c}},i=function(){var a=new XMLHttpRequest;return a},d.prototype.Settings=h,d.prototype.setupCredentials=function(a){if(g!=f)return a;if("withCredentials"in a)a.withCredentials=!0;else{if("undefined"==typeof XDomainRequest)throw new Error("CORS not supported");a=new XDomainRequest}return a},d.prototype.setRestPath=function(a,b){this.SITE_ROOT=a,this.SERVICES_ENDPOINT=b,this.REST_PATH=a+b+"/"},d.prototype.clearCsrfToken=function(a,b){h.setString(this.settingsPrefix+"X-CSRF-Token",null)},d.prototype.getCsrfToken=function(a,b){var c=h.getString(this.settingsPrefix+"X-CSRF-Token");if(c)return void a(c);var d=i(),e=this;d.onload=function(){h.setString(e.settingsPrefix+"X-CSRF-Token",d.responseText),console.log("got new CSRF token "+d.responseText),a(d.responseText)},d.onerror=function(a){console.log("error getting CSRF token:"),b(a)};var j=this.SITE_ROOT+"services/session/token";d.open("GET",j),d=this.setupCredentials(d);var k=h.getString(this.settingsPrefix+"Drupal-Cookie");g!=f&&d.setRequestHeader("Cookie",k),d.send()},d.prototype.systemConnect=function(a,b){var c=this,d=h.getString(this.settingsPrefix+"X-CSRF-Token");if(!d)return console.log("will request token before systemConnect"),void c.getCsrfToken(function(){c.systemConnect(a,b)},function(a){b(a)});console.log("will systemConnect with token "+d);var f=i(),j=this.REST_PATH+"system/connect";console.log("POSTing to url "+j),f.open("POST",j),f=this.setupCredentials(f),f.setRequestHeader("Accept","application/json"),f.setRequestHeader("Content-Type","application/json; charset=utf-8"),f.setRequestHeader("X-CSRF-Token",d),f.onload=function(){if(200===f.status){var d=f.responseText,e=JSON.parse(d),g=e.session_name+"="+e.sessid;h.setString(c.settingsPrefix+"Drupal-Cookie",g),a(e)}else{if(console.log("systemConnect error with "+f.status),401==f.status)return h.setString(c.settingsPrefix+"X-CSRF-Token",null),void setTimeout(function(){c.systemConnect(a,b)},0);console.log(f.getAllResponseHeaders()),console.log(f.responseText),b(f.responseText)}},f.onerror=function(a){console.log("There was an error calling systemConnect: "),console.log(a),h.setString(c.settingsPrefix+"X-CSRF-Token",null),h.setString(c.settingsPrefix+"Drupal-Cookie",null),b(a)},g===e&&f.clearCookies(this.SITE_ROOT),f.send()},d.prototype.makeRequest=function(a,b,c,d){var e="makeRequest()\n",f=this.REST_PATH+a.servicePath,g=i();if(e+=a.httpMethod+" "+f+"\n",a.timeout&&(g.timeout=a.timeout),g.open(a.httpMethod,f),g=this.setupCredentials(g),g.onerror=function(b){console.log(JSON.stringify(b)),console.log("FAILED REQUEST:"),console.log(e),console.log(a.params),c(b)},g.onload=function(){if(200===g.status){var a=JSON.parse(g.responseText);b(a)}else console.log("makeRequest returned with status "+g.status),c(g.responseText)},g.ondatastream=a.progress,g.setRequestHeader("Accept","application/json"),a.contentType&&(g.setRequestHeader("Content-Type",a.contentType),e+="Content-Type: "+a.contentType+"\n"),d)for(var h in d)e+=h+": "+d[h]+"\n",g.setRequestHeader(h,d[h]);a.trace&&(console.log(e),console.log(a.params)),a.contentType&&a.contentType.replace("application/x-www-form-urlencoded","")!=a.contentType&&(a.params=Object.keys(a.params).map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(a.params[b])}).join("&")),g.send(a.params)},d.prototype.makeAuthenticatedRequest=function(a,b,c,d){var e=d||{};if(!a.skipCookie&&g!=f){var i=h.getString(this.settingsPrefix+"Drupal-Cookie");e.Cookie=i}if(!a.skipCsrfToken){var j=h.getString(this.settingsPrefix+"X-CSRF-Token");e["X-CSRF-Token"]=j}this.makeRequest(a,b,c,e)},d.prototype.createAccount=function(a,b,c,d){console.log("Registering new user: "+JSON.stringify(a)+" with cookie "+h.getString(this.settingsPrefix+"Drupal-Cookie")),this.makeAuthenticatedRequest({httpMethod:"POST",servicePath:"user/register.json",contentType:"application/json",params:JSON.stringify(a)},function(a){console.log("registerNewUser SUCCESS"),b(a)},function(a){console.log("registerNewUser FAIL"),c(a)},d)},d.prototype.login=function(a,b,c,d,e){var f={username:a,password:b},g=this;this.makeAuthenticatedRequest({httpMethod:"POST",servicePath:"user/login.json",contentType:"application/json",params:JSON.stringify(f)},function(a){var b=a.session_name+"="+a.sessid;h.setString(g.settingsPrefix+"Drupal-Cookie",b),console.log("login saving new cookie "+b),h.setString(g.settingsPrefix+"X-CSRF-Token",a.token),console.log("login saving new token "+a.token),c(a.user)},d,e)},d.prototype.resetPassword=function(a,b,c,d){this.makeAuthenticatedRequest({httpMethod:"POST",servicePath:"user/"+a+"/password_reset.json",contentType:"application/json"},function(a){b(a)},c,d)},d.prototype.logout=function(a,b,c){var d=this;this.makeAuthenticatedRequest({httpMethod:"POST",servicePath:"user/logout.json"},function(b){h.setString(d.settingsPrefix+"X-CSRF-Token",null),a(b)},b,c)},d.prototype.getView=function(a,b,c,d,e){this.makeAuthenticatedRequest({servicePath:"views/"+a+".json?"+this.encodeUrlString(b),httpMethod:"GET",contentType:"application/json"},c,d,e)},d.prototype.getResource=function(a,b,c,d,e){this.makeAuthenticatedRequest({servicePath:a+".json?"+this.encodeUrlString(b),httpMethod:"GET"},c,d,e)},d.prototype.postResource=function(a,b,c,d,e){this.makeAuthenticatedRequest({servicePath:a+".json",httpMethod:"POST",params:JSON.stringify(b)},c,d,e)},d.prototype.putResource=function(a,b,c,d,e){this.makeAuthenticatedRequest({servicePath:a+".json",httpMethod:"PUT",contentType:"application/json",params:JSON.stringify(b)},c,d,e)},d.prototype.deleteResource=function(a,b,c,d,e){this.makeAuthenticatedRequest({servicePath:a+"/"+b+".json",httpMethod:"DELETE"},c,d,e)},d.prototype.createNode=function(a,b,c){this.makeAuthenticatedRequest({servicePath:"node",httpMethod:"POST",contentType:"application/json",params:JSON.stringify({node:a})},function(a){b(a)},function(a){console.log(JSON.stringify(a)),c(a)})},d.prototype.uploadFile=function(a,b,c,d,e,f,g){var h={file:a,filename:b,filesize:""+c};this.makeAuthenticatedRequest({servicePath:"file.json",httpMethod:"POST",contentType:"application/x-www-form-urlencoded; charset=utf-8",params:h,progress:f},d,e,g)},d.prototype.encodeUrlString=function(a){var b=[];for(var c in a){var d=a[c];b.push(c+"="+encodeURIComponent(d))}return b.join("&")},d.prototype.setSettingsPrefix=function(a){this.settingsPrefix=a},d.prototype.field=a("./field"),b.exports=d},{"./field":2}],2:[function(a,b,c){function d(a,b){var c=b||"value";if(e(a)){for(var d=[],f=0,g=a.length;g>f;f++){var h={};h[c]=a[f],d.push(h)}return{und:d}}if(a instanceof Date){var i={value:{date:a.getMonth()+1+"/"+a.getDate()+"/"+a.getFullYear()+" - "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()}};return{und:[i]}}if("object"==typeof a)return{und:[a]};var h={};return h[c]=a,{und:[h]}}function e(a){return"[object Array]"===Object.prototype.toString.call(a)}function f(a){var b=[];for(var c in a)if(a[c]instanceof Array)for(var d=0,e=a[c].length;e>d;d++)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c][d]));else b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")}c.structureField=d,c.serializeDrupalViewsFilter=f},{}],3:[function(a,b,c){window.Drupal=a("./lib/drupal")},{"./lib/drupal":1}]},{},[3]);